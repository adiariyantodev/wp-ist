const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;export function moduleData(){return{props:{display:String,name:String,block:Object},data(){return{loading:!0,rendered:!0,error:!1,apiLoaded:!1,errorMessage:"",total:0,comparisonTotal:0,percentChange:0,fetchingQuery:!1,requestFromGroupDate:!1,currentRequest:!1,chartData:{data:{main:[],comparison:[]},labels:{main:[],comparisons:[]},title:"",colors:{main:this.returnLineColor,comp:this.returnCompLineColor}},groupDate:{},strings:{lastPeriod:__("last period","uipress-pro"),selectDataMetric:__("Please select a chart metric in this block's options to show chart data.","uipress-pro"),changeAccount:__("Switch account","uipress-pro")}}},watch:{"block.settings.block.options.chartDataType":{handler(t,e){this.currentRequest&&this.processResponse()}},"uipApp.woocommerce.ready":{handler(t,e){this.getAnalytics()},deep:!0},"uipApp.woocommerce":{handler(t,e){t.ready&&this.getAnalytics()},deep:!0,immediate:!0}},mounted(){document.addEventListener("uipress/app/daterange/change",this.handleDateChange)},beforeUnmount(){document.removeEventListener("uipress/app/daterange/change",this.handleDateChange)},computed:{returnTotal(){if("total_revenue"==this.returnChartType){if("left"==this.currentRequest.currency_pos)return this.currentRequest.currency+this.total;if("left_space"==this.currentRequest.currency_pos)return this.currentRequest.currency+" "+this.total;if("right"==this.currentRequest.currency_pos)return this.total+this.currentRequest.currency;if("right_space"==this.currentRequest.currency_pos)return this.total+" "+this.currentRequest.currency}return this.total},returnChartSettings(){return this.get_block_option(this.block,"block","chartOptions")},returnComparisonTotal(){return this.comparisonTotal},returnChartData(){return this.chartData},returnName(){let t=this.get_block_option(this.block,"block","chartName",!0);return t?t=this.isObject(t)?t.string:t:""},returnChartType(){return this.get_block_option(this.block,"block","chartDataType")},returnChartStyle(){let t=this.get_block_option(this.block,"block","chartStyle");return t?t=this.isObject(t)?t.value:"line":"line"},returnLineColor(){let t=this.get_block_option(this.block,"block","chartColour");return t?t=this.isObject(t)?t.value:t:""},returnCompLineColor(){let t=this.get_block_option(this.block,"block","chartCompColour");return t?t=this.isObject(t)?t.value:t:""},hideChart(){let t=this.get_block_option(this.block,"block","hideChart");return t?t=this.isObject(t)?t.value:t:""},inlineAccountSwitch(){let t=this.get_block_option(this.block,"block","inlineAccountSwitch");return!t||(t=this.isObject(t)?t.value:t)},returnRange(){let t=this.get_block_option(this.block,"block","dateRange");return t?t=(t=isNaN(t)?14:t)>60?60:t:14},hasGlobalDate(){return!!this.hasNestedPath(this.groupDate,"start")}},methods:{handleDateChange(t){t.detail.IDS&&Array.isArray(t.detail.IDS)&&t.detail.IDS.includes(this.block.uid)&&(this.groupDate.start=t.detail.groupDate.start,this.groupDate.end=t.detail.groupDate.end,this.getAnalytics())},async getAnalytics(){if(this.loading=!0,this.error=!1,this.errorMessage="",!this.isObject(this.uipApp.woocommerce))return void(this.apiLoaded=!1);if(!("ready"in this.uipApp.woocommerce))return void(this.apiLoaded=!1);if(!this.uipApp.woocommerce.ready)return void(this.apiLoaded=!1);let t,e;this.apiLoaded=!0,this.hasGlobalDate?(t=new Date(Date.parse(this.groupDate.start)),e=new Date(Date.parse(this.groupDate.end))):((e=new Date).setDate(e.getDate()-1),(t=new Date).setDate(t.getDate()-this.returnRange));const r=await this.uipApp.woocommerce.api("get",t,e);if(r.error)return this.loading=!1,this.error=!0,void(this.errorMessage=r.message);this.loading=!1,this.currentRequest=r.data,this.processResponse()},processResponse(){let t=this.currentRequest,e=t.timeline.report.dates,r=t.timeline.report_comparison.dates,i=this.returnChartType,a=[],s=[];for(let[e,r]of t.timeline.report.data.entries())a.push(r[i]),void 0!==t.timeline.report_comparison.data[e]&&i in t.timeline.report_comparison.data[e]?s.push(t.timeline.report_comparison.data[e][i]):s.push("0");this.returnChartSettings&&(this.chartData.custom=this.returnChartSettings),this.chartData.colors.main=this.returnLineColor,this.chartData.colors.comp=this.returnCompLineColor,this.chartData.title=this.returnName,this.chartData.type=this.returnChartStyle,this.chartData.data.main=a,this.chartData.data.comparison=s,this.chartData.labels.main=e,this.chartData.labels.comparison=r,this.total=t.timeline.report.totals[i],i in t.timeline.report_comparison.totals?this.comparisonTotal=t.timeline.report_comparison.totals[i]:this.comparisonTotal="NA",this.percentChange=t.timeline.report.totals_change[i],""!=this.total&&(this.total=new Intl.NumberFormat(this.uipApp.data.options.locale).format(this.total)),""!=this.comparisonTotal&&"NA"!=this.comparisonTotal&&(this.comparisonTotal=new Intl.NumberFormat(this.uipApp.data.options.locale).format(this.comparisonTotal))},secondsToTime(t){if(isNaN(t)||t<0)return"0m 0s";return`${Math.floor(t/60).toString().padStart(2,"0")}m ${(t%60).toString().padStart(2,"0")}s`},returnErrrorMessage(){try{JSON.parse(this.errorMessage)}catch(t){return this.errorMessage}if(this.isObject(JSON.parse(this.errorMessage))){let t=JSON.parse(this.errorMessage);return`\n                <h5 style="margin:0">${t.status}</h5>\n                <p style="margin-bottom:0;">${t.message}</p>\n              `}return this.errorMessage}},template:'\n\t<div class="uip-flex uip-flex-column">\n  \n        <div class="uip-flex uip-flex-between">\n          <div class="uip-margin-bottom-xxs uip-text-normal uip-chart-title">{{returnName}}</div>\n        </div>\n        <div v-if="loading" class="uip-padding-m uip-flex uip-flex-center uip-flex-middle uip-min-w-200 uip-w-100p uip-ratio-16-10 uip-border-box"><loading-chart></loading-chart></div>\n        <div v-else-if="error && errorMessage" class="uip-padding-xs uip-border-round uip-background-orange-wash uip-text-bold uip-margin-bottom-s uip-scale-in-top uip-max-w-100p" v-html="returnErrrorMessage()"></div>\n        <div v-else-if="!returnChartType" class="uip-padding-xxs uip-border-round uip-background-green-wash uip-text-green uip-text-bold uip-margin-bottom-s uip-scale-in-top uip-max-w-200">{{strings.selectDataMetric}}</div>\n        <div v-else class="uip-min-w-200">\n          <div class="uip-flex uip-flex-column uip-row-gap-xs">\n            <div class="uip-flex uip-flex-between uip-gap-xxs uip-flex-center">\n              <div class="uip-text-xl uip-text-bold">{{returnTotal}}</div>\n              <div class="uip-text-s uip-background-orange-wash uip-border-round uip-padding-xxxs uip-padding-left-xs uip-padding-right-xs uip-post-type-label uip-flex uip-gap-xxs uip-flex-center uip-text-bold uip-tag-label">\n                <span v-if="percentChange > 0" class="uip-icon">arrow_upward</span>\n                <span v-if="percentChange < 0" class="uip-icon">arrow_downward</span>\n                <span>{{percentChange}}%</span>\n              </div>\n            </div>\n            <div class="uip-text-muted uip-margin-bottom-xs">vs. {{returnComparisonTotal}} {{strings.lastPeriod}}</div>\n            <uip-chart v-if="!hideChart && rendered" :chartData="returnChartData" class="uip-chart-canvas"/>\n            <div class="uip-flex uip-flex-row uip-flex-between" v-if="!hideChart">\n              <div class="uip-text-s uip-text-muted uip-chart-label">{{chartData.labels.main[0]}}</div>\n              <div class="uip-text-s uip-text-muted uip-chart-label">{{chartData.labels.main[chartData.labels.main.length - 1]}}</div>\n            </div>\n          </div>\n        </div>\n        \n\t</div>'}};