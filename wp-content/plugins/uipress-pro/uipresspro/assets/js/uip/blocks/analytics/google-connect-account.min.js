const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;export default{inject:["uiTemplate"],props:{success:Function},data:()=>({googliconNoHover:uipProPath+"assets/img/ga_btn_light.png",googliconHover:uipProPath+"assets/img/ga_btn_dark.png",hover:!1,analyticsWindow:null}),computed:{returnHoverImg(){return this.googliconHover},returnNoHoverImg(){return this.googliconNoHover},returnAccountOnUser(){return void 0!==this.uiTemplate.globalSettings.options&&this.hasNestedPath(this.uiTemplate,"globalSettings","options","analytics","saveAccountToUser")},returnStyle(){return this.hover?"opacity:1":"opacity:0"}},methods:{gauthWindow(){const t=this.buildOAuthUrl(),{x:e,y:o}=this.calculateWindowPosition(450,600),i=window.open(t,"name",`height=600,width=450,top=${o},left=${e}`);window.focus&&i.focus();const s=t=>{if("https://analytics.uipress.co"===t.origin&&t.data)try{const e=JSON.parse(t.data);e.code&&e.view&&(i.close(),this.uip_save_analytics(e),window.removeEventListener("message",s))}catch(t){console.error("Error processing the message event:",t)}};window.addEventListener("message",s)},buildOAuthUrl:()=>"https://accounts.google.com/o/oauth2/auth/oauthchooseaccount?response_type=code&client_id=285756954789-dp7lc40aqvjpa4jcqnfihcke3o43hmt1.apps.googleusercontent.com&redirect_uri=https://analytics.uipress.co&scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fanalytics.readonly&access_type=offline&approval_prompt=force&flowName=GeneralOAuthFlow",calculateWindowPosition:(t,e)=>({x:window.outerWidth/2+window.screenX-t/2,y:window.outerHeight/2+window.screenY-e/2}),handleWindowMessage(t){if("https://analytics.uipress.co"==t.origin&&t.data)try{const e=JSON.parse(t.data);e.code&&e.view&&(this.analyticsWindow.close(),this.uip_save_analytics(e))}catch(t){console.log(t)}},async uip_save_analytics(t){if(!("view"in t&&"code"in t))return void this.uipApp.notifications.notify(__("Connection failed","uipress-pro"),__("Incorrect credentials returned from account. Please try again","uipress-pro"),"error",!0);let e=new FormData;e.append("action","uip_save_google_analytics"),e.append("security",uip_ajax.security),e.append("analytics",JSON.stringify(t)),e.append("saveAccountToUser",this.returnAccountOnUser);const o=await this.sendServerRequest(uip_ajax.ajax_url,e);o.error?this.uipApp.notifications.notify(__("Unable to save account","uipress-pro"),o.message,"error",!0):this.success()}},template:'\n\t\t<a @mouseenter="hover = true" @mouseleave="hover = false" class="uip-position-relative uip-cursor-pointer" @click="gauthWindow()" style="width:120px;height:26px">\n\t\t\t<img width="120"  :src="returnNoHoverImg">\n\t\t\t<img width="120" class="uip-position-absolute uip-left-0" :style="returnStyle" :src="returnHoverImg">\n\t\t</a>'};