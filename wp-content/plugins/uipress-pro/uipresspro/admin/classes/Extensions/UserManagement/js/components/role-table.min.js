const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;export default{data(){return{loading:!0,modData:this.data,tableData:[],tablePage:1,selectAll:!1,queryRunning:!1,roles:[],strings:{search:__("Search","uipress-lite"),actions:__("Actions","uipress-lite"),roleName:__("Role name","uipress-lite"),roleLabel:__("Role label","uipress-lite"),users:__("Users","uipress-lite"),permissionsGranted:__("Permissions granted","uipress-lite"),others:__("others","uipress-lite"),noUsersWithRole:__("No users with this role","uipress-lite"),clone:__("Clone","uipress-lite"),delete:__("Delete","uipress-lite"),edit:__("Edit","uipress-lite"),clearSelection:__("Clear selection","uipress-lite")},search:"",tableOptions:{direction:"ASC",sortBy:"username",perPage:20},ui:{rolePanelOpen:!1,activeRole:[],newRoleOpen:!1,cloneRole:{}}}},mounted(){this.getRoleData(),this.uipApp.refreshTable=this.getRoleData},watch:{modData:{handler(e,t){this.dataChange(e)},deep:!0},tableFilters:{handler(e,t){this.getRoleData()},deep:!0},tableOptions:{handler(e,t){this.getRoleData()},deep:!0},selectAll:{handler(e,t){if(e)return this.selectAllRoles();this.deSelectAllRoles()}}},computed:{getTotalSelectedRoles(){return this.roles.filter(e=>!0===e.selected).length},returnSelectedRoleNames(){return this.roles.map(e=>{if(e.selected)return e.name})},returnSearchedRoles(){const e=this.search.toLowerCase();return this.roles.filter(t=>t.name.toLowerCase().includes(e))}},methods:{selectAllRoles(){this.roles.map(e=>e.selected=!0),this.selectAll=!0},deSelectAllRoles(){this.roles.map(e=>e.selected=!1),this.selectAll=!1},async getRoleData(){if(this.queryRunning)return;this.queryRunning=!0;let e=new FormData;e.append("action","uip_get_role_table_data"),e.append("security",this.AjaxSecurity);const t=await this.sendServerRequest(this.AjaxUrl,e);this.queryRunning=!1,t.error?this.uipApp.notifications.notify(t.message,"","error"):this.roles=t.roles},async deleteRoles(e){if(!await this.$refs.Confirm.show({title:__("Delete roles","uipress-pro"),message:__("Are you sure you want to delete these roles? This will remove the role sitewide","uipress-pro"),okButton:__("Delete","uipress-pro")}))return;const t=Array.isArray(e)?e:[e];let n=new FormData;n.append("action","uip_delete_roles"),n.append("security",this.AjaxSecurity),n.append("roles",JSON.stringify(t));const i=await this.sendServerRequest(this.AjaxUrl,n);i.error?this.uipApp.notifications.notify(i.message,"","error"):(this.uipApp.notifications.notify(i.message,"","success"),this.getRoleData())},cloneRole(e){this.uipApp.cloneRole={...e},this.$router.push("/roles/edit/new")}},template:'\n  \n  \n  \n  \n  <div class="uip-text-normal uip-flex uip-flex-column uip-row-gap-s">\n  \n    \x3c!--Filters--\x3e\n    \n    <div class="uip-flex uip-gap-xs uip-flex-center uip-flex-between">\n    \n      \x3c!--Search--\x3e\n      <div class="uip-background-muted uip-padding-xs uip-padding-top-xxs uip-padding-bottom-xxs uip-border-rounder uip-flex uip-flex-center uip-gap-xs">\n        <span class="uip-icon uip-text-muted">search</span>\n        <input class="uip-blank-input uip-flex-grow uip-text-s" :placeholder="strings.search" v-model="search">\n      </div>\n      \n      \x3c!--Batch actions--\x3e\n      <dropdown pos="bottom right" ref="bulkActions">\n        \n        <template #trigger>\n        \n          <button :disabled="!getTotalSelectedRoles" class="uip-button-default uip-text-s">{{strings.actions}} ({{getTotalSelectedRoles}})</button>\n        \n        </template>\n        \n        <template #content>\n        \n          <div class="uip-padding-xs uip-flex uip-flex-column uip-text-weight-normal uip-text-s">\n          \n            <a @click="deSelectAllRoles();$refs.bulkActions.close()" \n            class="uip-link-default uip-flex uip-flex-center uip-flex-between uip-gap-m uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-no-underline">\n              <span class="">{{strings.clearSelection}}</span>\n              <span class="uip-icon">backspace</span>\n            </a>\n            \n            \n            <div class="uip-border-top uip-margin-top-xs uip-margin-bottom-xs"></div>\n            \n            <a class="uip-link-danger uip-flex uip-flex-center uip-flex-between uip-gap-m uip-padding-xxs hover:uip-background-muted uip-border-rounder"\n            @click.prevent="deleteRoles(returnSelectedRoleNames);$refs.bulkActions.close()">\n              <span class="">{{strings.delete}}</span>\n              <span class="uip-icon">delete</span>\n            </a>\n          \n          </div>\n        \n        </template>\n      \n      </dropdown>\n        \n        \n    \n    </div>\n    \n    <table class="uip-background-transparent uip-template-table" style="border-collapse: collapse;\n    border-spacing: 0;"> \n    \n      <thead>\n      \n        <tr>\n          <th class="uip-padding-top-s uip-padding-bottom-s uip-border-bottom uip-border-top uip-text-left"><input type="checkbox" class="uip-checkbox" v-model="selectAll"></th>\n          <th class="uip-padding-top-s uip-padding-bottom-s uip-border-bottom uip-border-top uip-text-muted uip-text-weight-normal uip-text-left">{{strings.roleLabel}}</th>\n          <th class="uip-padding-top-s uip-padding-bottom-s uip-border-bottom uip-border-top uip-text-muted uip-text-weight-normal uip-text-left">{{strings.permissionsGranted}}</th>\n          <th class="uip-padding-top-s uip-padding-bottom-s uip-border-bottom uip-border-top uip-text-muted uip-text-weight-normal uip-text-left">{{strings.roleName}}</th>\n          <th class="uip-padding-top-s uip-padding-bottom-s uip-border-bottom uip-border-top uip-text-muted uip-text-weight-normal uip-text-left">{{strings.users}}</th>\n          <th class="uip-padding-top-s uip-padding-bottom-s uip-border-bottom uip-border-top"></th>\n        </tr>  \n      \n      \n      </thead>\n    \n      <TransitionGroup name="list" tag="tbody">\n      \n        <tr v-for="(role, index) in returnSearchedRoles" :key="role.name" @contextmenu.prevent.stop="$refs[\'roleMenu-\'+index][0].show($event)">\n        \n          \x3c!--Selector--\x3e\n          <td class="uip-padding-top-xs uip-padding-bottom-xs uip-border-bottom uip-text-left">\n            <input class="uip-checkbox" :data-id="role.name" type="checkbox" v-model="role.selected">\n          </td>\n          \n          \x3c!--Label--\x3e\n          <td @click="$router.push(\'/roles/edit/\' + role.name)"\n          class="uip-padding-top-xs uip-padding-bottom-xs uip-border-bottom uip-text-left uip-text-bold uip-text-emphasis uip-link-emphasis">\n            {{role.label}}\n          </td>\n          \n          \x3c!--Granted--\x3e\n          <td class="uip-padding-top-xs uip-padding-bottom-xs uip-border-bottom uip-text-left">\n            <span class="uip-background-primary-wash uip-border-round uip-padding-left-xxs uip-padding-right-xxs">{{role.granted}}</span>\n          </td>\n          \n          \x3c!--Name--\x3e\n          <td class="uip-padding-top-xs uip-padding-bottom-xs uip-border-bottom uip-text-left">\n            {{role.name}}\n          </td>\n          \n          \x3c!--Users--\x3e\n          <td class="uip-padding-top-xs uip-padding-bottom-xs uip-border-bottom uip-text-left">\n            <div class="uip-flex uip-gap-xxs uip-flex-center">\n                                \n                                \n              <div v-if="role.users.length > 0" class="uip-flex uip-flex-reverse uip-margin-left-xxs">\n                <template v-for="(user,index) in role.users">\n                \n                  <div class="uip-w-20 uip-ratio-1-1 uip-text-s uip-background-primary-wash uip-border-circle uip-border-match uip-text-capitalize \n                  uip-text-center uip-line-height-1 uip-text-center uip-flex uip-flex-center uip-flex-middle uip-margin-left--8" :title="user">\n                    {{user[0]}}\n                  </div>\n                  \n                </template>\n              </div>\n              \n              <div v-if="role.usersCount > role.users.length" class="uip-text-muted uip-text-s">+{{role.usersCount - role.users.length}} {{strings.others}}</div>\n              \n              <div v-else-if="role.users.length == 0" class="uip-text-muted uip-text-s">{{strings.noUsersWithRole}}</div>\n              \n              \n            </div>\n          </td>\n          \n          \n          \x3c!--Actions--\x3e\n          <td class="uip-padding-top-xs uip-padding-bottom-xs uip-border-bottom uip-text-right">\n            <div class="uip-inline-flex" @click.prevent.stop="$refs[\'roleMenu-\'+index][0].show($event)">\n              <a class="uip-link-default hover:uip-background-muted uip-border-rounder uip-icon uip-padding-xxs">more_vert</a>\n            </div>\n          </td>\n        \n        </tr>\n        \n      </TransitionGroup>\n      \n    </table>  \n    \n  </div>  \n  \n  \n  <Confirm ref="Confirm"/>\n  \n  \n  <template v-for="(role, index) in returnSearchedRoles">\n    <ContextMenu :ref="\'roleMenu-\'+index">\n    \n      <div class="uip-padding-xs uip-flex uip-flex-column uip-text-weight-normal uip-text-s">\n            \n        <router-link :to="\'/roles/edit/\' + role.name" @click="$refs[\'roleMenu-\'+index][0].close()" \n        class="uip-link-default uip-flex uip-flex-center uip-flex-between uip-gap-m uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-no-underline">\n          <span class="">{{strings.edit}}</span>\n          <span class="uip-icon">edit</span>\n        </router-link>\n        \n        <a @click="cloneRole(role);$refs[\'roleMenu-\'+index][0].close()" \n        class="uip-link-default uip-flex uip-flex-center uip-flex-between uip-gap-m uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-no-underline">\n          <span class="">{{strings.clone}}</span>\n          <span class="uip-icon">content_copy</span>\n        </a>\n        \n        <div class="uip-border-top uip-margin-top-xs uip-margin-bottom-xs"></div>\n        \n        <a class="uip-link-danger uip-flex uip-flex-center uip-flex-between uip-gap-m uip-padding-xxs hover:uip-background-muted uip-border-rounder"\n        @click.prevent="deleteRoles(role.name);$refs[\'roleMenu-\'+index][0].close()">\n          <span class="">{{strings.delete}}</span>\n          <span class="uip-icon">delete</span>\n        </a>\n      \n      </div>\n    \n    </ContextMenu>\n  </template>\n      '};